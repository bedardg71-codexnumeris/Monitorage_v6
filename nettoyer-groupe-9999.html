<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Nettoyage Groupe 9999</title>
</head>
<body>
    <h1>Script de nettoyage - Groupe 9999</h1>
    <p>Ce script supprime UNIQUEMENT les donn√©es du groupe 9999</p>
    <button onclick="nettoyerGroupe9999()" style="padding: 10px 20px; font-size: 16px; background: #d32f2f; color: white; border: none; cursor: pointer;">
        üóëÔ∏è Supprimer toutes les donn√©es du groupe 9999
    </button>

    <div id="resultat" style="margin-top: 20px; padding: 10px; background: #f5f5f5;"></div>

    <script src="js/db.js"></script>
    <script>
        function nettoyerGroupe9999() {
            if (!confirm('‚ö†Ô∏è ATTENTION ‚ö†Ô∏è\n\nCette action va supprimer TOUTES les donn√©es du groupe 9999 :\n‚Ä¢ Le cours 601-101-h2026-9999\n‚Ä¢ Les 10 √©tudiants du groupe 9999\n‚Ä¢ Toutes les √©valuations associ√©es\n‚Ä¢ Toutes les pr√©sences associ√©es\n\nVos autres donn√©es (groupe 00001, etc.) seront PR√âSERV√âES.\n\nContinuer ?')) {
                return;
            }

            const resultat = document.getElementById('resultat');
            resultat.innerHTML = '<h2>Nettoyage en cours...</h2>';

            let rapport = [];

            // 1. Supprimer le cours d√©mo
            let cours = db.getSync('listeCours', []);
            const nbCoursAvant = cours.length;
            cours = cours.filter(c => c.id !== '601-101-h2026-9999' && c.groupe !== '9999');
            db.setSync('listeCours', cours);
            rapport.push(`‚úÖ Cours : ${nbCoursAvant - cours.length} supprim√©(s)`);

            // 2. Supprimer les √©tudiants du groupe 9999
            let etudiants = db.getSync('groupeEtudiants', []);
            const nbEtudiantsAvant = etudiants.length;
            etudiants = etudiants.filter(e => e.groupe !== '9999' && e.coursId !== '601-101-h2026-9999');
            db.setSync('groupeEtudiants', etudiants);
            rapport.push(`‚úÖ √âtudiants : ${nbEtudiantsAvant - etudiants.length} supprim√©(s)`);

            // 3. Supprimer les productions du cours d√©mo
            let productions = db.getSync('productions', []);
            const nbProductionsAvant = productions.length;
            productions = productions.filter(p => p.coursId !== '601-101-h2026-9999');
            db.setSync('productions', productions);
            rapport.push(`‚úÖ Productions : ${nbProductionsAvant - productions.length} supprim√©e(s)`);

            // 4. Supprimer les √©valuations du groupe d√©mo
            let evaluations = db.getSync('evaluationsSauvegardees', []);
            const nbEvalsAvant = evaluations.length;
            evaluations = evaluations.filter(e => e.coursId !== '601-101-h2026-9999');
            db.setSync('evaluationsSauvegardees', evaluations);
            rapport.push(`‚úÖ √âvaluations : ${nbEvalsAvant - evaluations.length} supprim√©e(s)`);

            // 5. Supprimer les pr√©sences du groupe d√©mo
            // Trouver les DA du groupe 9999
            const dasDemoSupprimes = db.getSync('groupeEtudiants', [])
                .filter(e => e.groupe === '9999' || e.coursId === '601-101-h2026-9999')
                .map(e => e.da);

            let presences = db.getSync('presences', []);
            const nbPresencesAvant = presences.length;

            // Liste des DA du groupe d√©mo (au cas o√π ils auraient d√©j√† √©t√© supprim√©s)
            const dasDemo = ['2234567', '2234568', '2234569', '2234570', '2234571',
                             '2234572', '2234573', '2234574', '2234575', '2234576'];

            presences = presences.filter(p => !dasDemo.includes(p.da) && !dasDemoSupprimes.includes(p.da));
            db.setSync('presences', presences);
            rapport.push(`‚úÖ Pr√©sences : ${nbPresencesAvant - presences.length} supprim√©e(s)`);

            // 6. Effacer le flag de d√©monstration
            db.setSync('donneesDemo', false);
            rapport.push(`‚úÖ Flag donneesDemo effac√©`);

            // Afficher le rapport
            resultat.innerHTML = '<h2>‚úÖ Nettoyage termin√© !</h2>' +
                '<ul style="text-align: left; max-width: 500px; margin: 20px auto;">' +
                rapport.map(r => `<li>${r}</li>`).join('') +
                '</ul>' +
                '<p style="margin-top: 20px;"><strong>Rechargez la page pour voir les changements.</strong></p>' +
                '<button onclick="window.location.reload()" style="padding: 10px 20px; background: #2196F3; color: white; border: none; cursor: pointer; font-size: 16px;">üîÑ Recharger la page</button>';
        }

        // Attendre que db.js soit charg√©
        window.addEventListener('db-ready', function() {
            console.log('‚úÖ DB pr√™t pour nettoyage');
        });
    </script>
</body>
</html>

039-Demande

CONTEXTE : Application de monitorage p√©dagogique (index3.html). Nous avons d√©velopp√© plusieurs onglets dans la sous-navigation des R√©glages. Ces sections servent √† d√©finir des param√®tres qui serviront dans les sections √âtudiant¬∑es, Pr√©sences, √âvaluations. Nous sommes pr√©sentement dans l'onglet ¬´Planification des √©valuation¬ª de la sous-nav ¬´R√©glages¬ª

OBJECTIF : Nous allons apporter quelques modifications dans le formulaire de ¬´Planification des √©valuations¬ª. Nous allons optimiser l'espace.
- Nous allons ajouter un champ pour la description de chaque travail (ex. Strat√©gies de lecture)
- Nous allons ajouter un champ pour la description de l'objectif (ex. D√©velopper sa capacit√© √† utiliser efficacement diff√©rentes strat√©gies de lecture et √† documenter de mani√®re claire et m√©thodique son processus d'analyse.)
- Nous allons ajouter un champ pour la description de la t√¢che (ex. Appliquer au moins trois strat√©gies de lecture diff√©rentes sur un texte litt√©raire et laisser des traces visibles et organis√©es de cette analyse.)
- Les champs (type, pond√©ration, code) doivent √™tre sur une m√™me ligne
- Les champs (description, objectif) doivent √™tre sur une m√™me ligne


ZONES AUTORIS√âES : NE PAS toucher aux autres √©l√©ments de contenu

NOMS STABLES : Respecter et conserver tous les noms dans NOMS_STABLES.json - AUCUN renommage

CODE : 

--
HTML
--

<!-- CARTE 2 : D√âFINITION DES √âVALUATIONS -->
            <div class="carte">
                <h3>üìù Planification des √©valuations</h3>

                <!-- VUE D'ENSEMBLE -->
                <div class="grille-statistiques" style="margin-bottom: 20px;">
                    <div class="carte-metrique">
                        <strong id="nombreEvaluations">0</strong>
                        <span>√âvaluations</span>
                    </div>
                    <div class="carte-metrique">
                        <strong id="ponderationTotale">0%</strong>
                        <span>Total</span>
                        <small id="statutPonderation" style="display: block; margin-top: 5px;"></small>
                    </div>
                    <div class="carte-metrique" style="grid-column: span 2;">
                        <span id="typesEvaluations" style="font-size: 0.9rem;">
                            Aucune √©valuation configur√©e
                        </span>
                    </div>
                </div>

                <!-- TABLEAU/CONTENEUR DES √âVALUATIONS -->
                <div id="tableauEvaluationsContainer" style="margin-bottom: 20px;">
                    <p class="text-muted" id="aucuneEvaluation" style="font-style: italic;">Aucune √©valuation d√©finie.
                    </p>
                </div>

                <!-- FORMULAIRE D'AJOUT/MODIFICATION (cach√© par d√©faut) -->
                <div id="formulaireEvaluation" style="display: none; margin-top: 20px; padding: 15px; 
             background: var(--bleu-pale); border-radius: 6px;">

                    <h4 id="titreFormEvaluation" style="color: var(--bleu-principal); margin-bottom: 15px;">
                        Nouvelle √©valuation
                    </h4>

                    <div style="display: grid; grid-template-columns: 1fr 150px 100px; gap: 15px;">
                        <div class="groupe-form">
                            <label>Titre de l'√©valuation</label>
                            <input type="text" id="evalTitre" class="controle-form"
                                placeholder="Ex: Analyse litt√©raire #1">
                        </div>
                        <div class="groupe-form">
                            <label>Type</label>
                            <select id="evalType" class="controle-form">
                                <option value="">Choisir...</option>
                                <option value="examen">Examen</option>
                                <option value="travail">Travail √©crit</option>
                                <option value="quiz">Quiz/Test</option>
                                <option value="presentation">Pr√©sentation</option>
                                <option value="portfolio">Portfolio</option>
                                <option value="autre">Autre</option>
                            </select>
                        </div>
                        <div class="groupe-form">
                            <label>Pond√©ration (%)</label>
                            <input type="number" id="evalPonderation" class="controle-form" min="0" max="100" step="5"
                                placeholder="Ex: 20">
                        </div>
                    </div>

                    <div class="btn-groupe mt-2" style="justify-content: flex-end;">
                        <button class="btn btn-annuler" onclick="annulerFormEvaluation()">Annuler</button>
                        <button class="btn btn-confirmer" onclick="sauvegarderEvaluation()">
                            <span id="btnTexteEvaluation">Ajouter</span>
                        </button>
                    </div>
                </div>

                <button id="btnAjouterEvaluation" class="btn btn-ajouter mt-2" onclick="afficherFormEvaluation()">
                    + Ajouter une √©valuation
                </button>
            </div>

        </div><!--fin sous-section liste-evaluations-->

--
JAVA
--

// Variables pour la gestion des √©valuations
        let evaluationEnEdition = null;

        function afficherFormEvaluation(id = null) {
            const formulaire = document.getElementById('formulaireEvaluation');
            const btnAjouter = document.getElementById('btnAjouterEvaluation');
            const titre = document.getElementById('titreFormEvaluation');
            const btnTexte = document.getElementById('btnTexteEvaluation');

            formulaire.style.display = 'block';
            btnAjouter.style.display = 'none';

            if (id) {
                // Mode √©dition
                const evaluations = JSON.parse(localStorage.getItem('listeEvaluations') || '[]');
                const eval = evaluations.find(e => e.id === id);

                if (eval) {
                    evaluationEnEdition = id;
                    titre.textContent = 'Modifier l\'√©valuation';
                    btnTexte.textContent = 'Sauvegarder';

                    document.getElementById('evalTitre').value = eval.titre;
                    document.getElementById('evalType').value = eval.type;
                    document.getElementById('evalPonderation').value = eval.ponderation;
                }
            } else {
                // Mode ajout
                evaluationEnEdition = null;
                titre.textContent = 'Nouvelle √©valuation';
                btnTexte.textContent = 'Ajouter';

                // R√©initialiser les champs
                document.getElementById('evalTitre').value = '';
                document.getElementById('evalType').value = '';
                document.getElementById('evalPonderation').value = '';
            }
        }

        function annulerFormEvaluation() {
            document.getElementById('formulaireEvaluation').style.display = 'none';
            document.getElementById('btnAjouterEvaluation').style.display = 'inline-block';
            evaluationEnEdition = null;
        }

        function sauvegarderEvaluation() {
            const titre = document.getElementById('evalTitre').value.trim();
            const type = document.getElementById('evalType').value;
            const ponderation = parseInt(document.getElementById('evalPonderation').value) || 0;

            if (!titre || !type || ponderation === 0) {
                alert('Veuillez remplir tous les champs');
                return;
            }

            let evaluations = JSON.parse(localStorage.getItem('listeEvaluations') || '[]');

            if (evaluationEnEdition) {
                // Modifier l'√©valuation existante
                const index = evaluations.findIndex(e => e.id === evaluationEnEdition);
                if (index !== -1) {
                    evaluations[index] = {
                        ...evaluations[index],
                        titre,
                        type,
                        ponderation
                    };
                }
            } else {
                // Ajouter nouvelle √©valuation
                const nouvelleEval = {
                    id: 'EV' + (evaluations.length + 1),
                    code: 'EV' + (evaluations.length + 1),
                    titre,
                    type,
                    ponderation,
                    verrouille: false
                };
                evaluations.push(nouvelleEval);
            }

            localStorage.setItem('listeEvaluations', JSON.stringify(evaluations));

            annulerFormEvaluation();
            afficherTableauEvaluations();
            mettreAJourPonderationTotale();

            // Afficher la d√©finition de notation par d√©faut
            setTimeout(() => {
                if (document.getElementById('pratiqueNotation')) {
                    afficherInfoPAN();
                }
            }, 100);
            mettreAJourStatutModalites();
        }

        function afficherTableauEvaluations() {
            const evaluations = JSON.parse(localStorage.getItem('listeEvaluations') || '[]');
            const container = document.getElementById('tableauEvaluationsContainer');
            const aucuneMsg = document.getElementById('aucuneEvaluation');

            if (evaluations.length === 0) {
                container.innerHTML = '<p class="text-muted" style="font-style: italic;">Aucune √©valuation d√©finie.</p>';
                document.getElementById('typesEvaluations').innerHTML =
                    '<span style="color: var(--bleu-leger);">Aucune √©valuation configur√©e</span>';
                document.getElementById('nombreEvaluations').textContent = '0';
                return;
            }

            container.innerHTML = evaluations.map((eval, index) => `
        <div style="padding: 12px; background: var(--bleu-tres-pale); border: 1px solid var(--bleu-leger); border-radius: 6px; margin-bottom: 10px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <strong style="color: var(--bleu-principal);">${eval.code} - ${eval.titre}</strong>
                <div>
                    ${index > 0 ?
                    `<button onclick="monterEvaluation('${eval.id}')" class="btn btn-principal" 
                         style="padding: 5px 10px; font-size: 0.85rem; margin-right: 5px;" 
                         ${eval.verrouille ? 'disabled' : ''}>‚Üë</button>` : ''}
                    ${index < evaluations.length - 1 ?
                    `<button onclick="descendreEvaluation('${eval.id}')" class="btn btn-principal" 
                         style="padding: 5px 10px; font-size: 0.85rem; margin-right: 10px;" 
                         ${eval.verrouille ? 'disabled' : ''}>‚Üì</button>` : ''}
                    <label style="font-size: 0.85rem; margin-right: 10px;">
                        <input type="checkbox" id="unlock-eval-${eval.id}" 
                               onchange="basculerVerrouillageEval('${eval.id}')" 
                               ${eval.verrouille ? 'checked' : ''}>
                        Verrouill√©
                    </label>
                    <button class="btn btn-modifier" onclick="modifierEvaluation('${eval.id}')" 
                            style="padding: 5px 12px; font-size: 0.85rem; 
                                   opacity: ${eval.verrouille ? '0.5' : '1'};"
                            ${eval.verrouille ? 'disabled' : ''}>
                        Modifier
                    </button>
                    <button class="btn btn-supprimer" onclick="supprimerEvaluation('${eval.id}')" 
                            style="padding: 5px 12px; font-size: 0.85rem; margin-left: 5px; 
                                   opacity: ${eval.verrouille ? '0.5' : '1'};"
                            ${eval.verrouille ? 'disabled' : ''}>
                        Supprimer
                    </button>
                </div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                <div>
                    <label style="font-size: 0.75rem; color: var(--bleu-moyen);">Type</label>
                    <input type="text" value="${getTypeLabel(eval.type)}" class="controle-form" 
                           readonly style="font-size: 0.85rem;">
                </div>
                <div>
                    <label style="font-size: 0.75rem; color: var(--bleu-moyen);">Pond√©ration</label>
                    <input type="text" value="${eval.ponderation}%" class="controle-form" 
                           readonly style="font-size: 0.85rem; font-weight: bold;">
                </div>
                <div>
                    <label style="font-size: 0.75rem; color: var(--bleu-moyen);">Code</label>
                    <input type="text" value="${eval.code}" class="controle-form" 
                           readonly style="font-size: 0.85rem;">
                </div>
            </div>
        </div>
    `).join('');

            document.getElementById('nombreEvaluations').textContent = evaluations.length;
            mettreAJourResumeTypes(evaluations);
        }

        function getTypeLabel(type) {
            const labels = {
                'examen': 'Examen',
                'travail': 'Travail √©crit',
                'quiz': 'Quiz/Test',
                'presentation': 'Pr√©sentation',
                'portfolio': 'Portfolio',
                'autre': 'Autre'
            };
            return labels[type] || type;
        }

        function mettreAJourResumeTypes(evaluations) {
            const compteurTypes = {};
            evaluations.forEach(eval => {
                compteurTypes[eval.type] = (compteurTypes[eval.type] || 0) + 1;
            });

            const resume = Object.entries(compteurTypes)
                .map(([type, count]) => `${count} ${getTypeLabel(type).toLowerCase()}${count > 1 ? 's' : ''}`)
                .join(', ');

            document.getElementById('typesEvaluations').textContent = resume || 'Aucune √©valuation';
        }

        function mettreAJourPonderationTotale() {
            const evaluations = JSON.parse(localStorage.getItem('listeEvaluations') || '[]');
            const total = evaluations.reduce((sum, eval) => sum + eval.ponderation, 0);

            const totalSpan = document.getElementById('ponderationTotale');
            const statutSpan = document.getElementById('statutPonderation');

            totalSpan.textContent = total + '%';

            if (total === 100) {
                totalSpan.style.color = 'var(--risque-minimal)';
                statutSpan.textContent = '‚úì';
                statutSpan.style.color = 'var(--risque-minimal)';
            } else if (total < 100) {
                totalSpan.style.color = 'var(--risque-modere)';
                statutSpan.textContent = `(${100 - total}% manquant)`;
                statutSpan.style.color = 'var(--risque-modere)';
            } else {
                totalSpan.style.color = 'var(--risque-critique)';
                statutSpan.textContent = `(${total - 100}% en trop)`;
                statutSpan.style.color = 'var(--risque-critique)';
            }

            // Mettre √† jour le nombre dans la carte 1
            document.getElementById('nombreEvaluations').value = evaluations.length;
        }

        function modifierEvaluation(id) {
            afficherFormEvaluation(id);
        }

        function supprimerEvaluation(id) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer cette √©valuation ?')) {
                let evaluations = JSON.parse(localStorage.getItem('listeEvaluations') || '[]');
                evaluations = evaluations.filter(e => e.id !== id);

                // Recalculer les codes
                evaluations.forEach((eval, index) => {
                    eval.code = 'EV' + (index + 1);
                    eval.id = 'EV' + (index + 1);
                });

                localStorage.setItem('listeEvaluations', JSON.stringify(evaluations));
                afficherTableauEvaluations();
                mettreAJourPonderationTotale();
                mettreAJourStatutModalites();
            }
        }

        function verrouillerEvaluation(id) {
            let evaluations = JSON.parse(localStorage.getItem('listeEvaluations') || '[]');
            const index = evaluations.findIndex(e => e.id === id);

            if (index !== -1) {
                evaluations[index].verrouille = !evaluations[index].verrouille;
                localStorage.setItem('listeEvaluations', JSON.stringify(evaluations));
                afficherTableauEvaluations();
            }
        }

        function basculerVerrouillageEval(id) {
            let evaluations = JSON.parse(localStorage.getItem('listeEvaluations') || '[]');
            const index = evaluations.findIndex(e => e.id === id);

            if (index !== -1) {
                evaluations[index].verrouille = document.getElementById(`unlock-eval-${id}`).checked;
                localStorage.setItem('listeEvaluations', JSON.stringify(evaluations));
                afficherTableauEvaluations();
            }
        }

ATTENDU : voir capture

FORMAT : Patch minimal uniquement
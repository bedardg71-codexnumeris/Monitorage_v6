# Plan de match - Suite refonte modulaire Index 70

## üìç O√π nous en sommes

### ‚úÖ COMMIT 1 COMPL√âT√â
**Module trimestre.js refond√© - Source unique calendrier**

**Ce qui fonctionne :**
- ‚úÖ Module `trimestre.js` est la **source unique de v√©rit√©**
- ‚úÖ Fonction `genererCalendrierComplet()` g√©n√®re tous les jours du trimestre
- ‚úÖ Stockage dans `localStorage.calendrierComplet` (124 jours g√©n√©r√©s)
- ‚úÖ Statistiques correctes : 16 semaines | 75 jours de cours | 2 cong√©s
- ‚úÖ API publique : `obtenirCalendrierComplet()` et `obtenirInfosJour(date)`
- ‚úÖ Interface HTML clarifi√©e : "Trimestre" (admin) vs "Calendrier" (p√©dago)
- ‚úÖ Fix conflit de noms : `formaterDateTrimestreYMD()` au lieu de `formaterDate()`

**Fichiers modifi√©s :**
- `js/trimestre.js` (refonte compl√®te - 638 lignes)
- `index 70 (refonte des modules).html` (section renomm√©e)
- `js/config.js` (label bouton navigation)
- `js/navigation.js` (ajout initialisation module Trimestre)

---

## üéØ PROCHAINE √âTAPE : Module calendrier-vue.js

### Objectif
Adapter `calendrier-vue.js` pour qu'il **LISE** le `calendrierComplet` au lieu de **RECALCULER** les dates.

### Principe architectural (CRUCIAL)
```
trimestre.js (R√âGLAGES)
    ‚Üì produit
calendrierComplet (localStorage)
    ‚Üì lu par
calendrier-vue.js (PR√âSENCES ‚Ä∫ Vue calendaire)
    ‚Üì affiche
Calendrier visuel avec couleurs et liens
```

**R√àGLE D'OR** : `calendrier-vue.js` ne doit **JAMAIS** :
- Calculer le statut d'un jour
- D√©terminer si c'est un weekend, cong√©, reprise
- Compter les semaines ou jours de cours
- Appeler des fonctions comme `genererSemainesScolaires()`

Il doit **UNIQUEMENT** :
- Lire `calendrierComplet` via `obtenirCalendrierComplet()`
- G√©n√©rer le HTML d'affichage
- Appliquer les couleurs CSS selon les statuts

---

## üìã Structure du calendrierComplet

### Format des donn√©es (localStorage)
```javascript
{
  "2025-08-21": { 
    statut: "cours",
    numeroSemaine: 1,
    numeroJour: 1,
    jourSemaine: "Jeudi"
  },
  "2025-08-22": { 
    statut: "cours",
    numeroSemaine: 1,
    numeroJour: 2,
    jourSemaine: "Vendredi"
  },
  "2025-08-23": { 
    statut: "weekend",
    jourSemaine: "Samedi"
  },
  "2025-09-01": { 
    statut: "conge",
    motif: "F√™te du travail",
    jourSemaine: "Lundi"
  },
  "2025-09-04": { 
    statut: "reprise",
    numeroSemaine: 3,
    numeroJour: 12,
    jourSemaine: "Jeudi"
  },
  "2025-10-13": { 
    statut: "semaine-planification",
    jourSemaine: "Lundi"
  },
  "2025-12-15": { 
    statut: "semaine-examens",
    jourSemaine: "Lundi"
  }
}
```

### Statuts possibles
- `"cours"` : jour de cours normal
- `"reprise"` : jour de reprise d'un cong√©
- `"conge"` : cong√© (avec motif)
- `"weekend"` : samedi ou dimanche
- `"semaine-planification"` : semaine de planification
- `"semaine-examens"` : semaine d'examens
- `"hors-cours"` : apr√®s la fin des cours mais avant la fin du trimestre

---

## üîß Approche de refonte de calendrier-vue.js

### √âtape 1 : Analyse du code actuel
Identifier dans `calendrier-vue.js` :
1. Toutes les fonctions qui **calculent** au lieu de **lire**
2. Les appels √† `genererSemainesScolaires()` (√† supprimer)
3. Les v√©rifications de statut (weekend, cong√©, etc.) - √† remplacer par lecture
4. La g√©n√©ration HTML du calendrier (√† garder mais simplifier)

### √âtape 2 : Simplification radicale
Remplacer la logique complexe par :
```javascript
function afficherCalendrierScolaire() {
    // 1. R√©cup√©rer le calendrier complet (lecture seule)
    const calendrier = obtenirCalendrierComplet();
    
    // 2. R√©cup√©rer les param√®tres d'affichage
    const cadre = JSON.parse(localStorage.getItem('cadreCalendrier') || '{}');
    
    // 3. G√©n√©rer le HTML mois par mois
    const htmlCalendrier = genererHtmlCalendrier(calendrier, cadre);
    
    // 4. Injecter dans le DOM
    document.getElementById('conteneur-calendrier').innerHTML = htmlCalendrier;
}
```

### √âtape 3 : Fonction de g√©n√©ration HTML
```javascript
function genererHtmlCalendrier(calendrier, cadre) {
    // D√©terminer les mois √† afficher (session A ou H)
    const moisAAfficher = determinerMoisSession(cadre);
    
    let html = '<div class="grille-mois">';
    
    moisAAfficher.forEach(mois => {
        html += genererHtmlMois(mois.annee, mois.mois, calendrier);
    });
    
    html += '</div>';
    return html;
}

function genererHtmlMois(annee, mois, calendrier) {
    // Pour chaque jour du mois
    // Chercher dans calendrier[dateStr]
    // Appliquer la couleur CSS selon infosJour.statut
    // Cr√©er le HTML avec les classes appropri√©es
}
```

### √âtape 4 : Mapping statut ‚Üí CSS
```javascript
const CLASSES_CSS_PAR_STATUT = {
    'cours': 'cal-jour-cours',
    'reprise': 'cal-reprise',
    'conge': 'cal-conge',
    'weekend': 'cal-weekend',
    'semaine-planification': 'cal-planification',
    'semaine-examens': 'cal-examens',
    'hors-cours': 'cal-hors-cours'
};
```

---

## ‚ö†Ô∏è Pi√®ges √† √©viter

### 1. Ne pas recr√©er de logique de calcul
‚ùå **INTERDIT** :
```javascript
if (estWeekend(date)) { ... }
if (estConge(date, config)) { ... }
```

‚úÖ **CORRECT** :
```javascript
const infos = calendrier[dateStr];
if (infos.statut === 'weekend') { ... }
```

### 2. Ne pas recalculer les semaines
‚ùå **INTERDIT** :
```javascript
const semaines = genererSemainesScolaires(config);
```

‚úÖ **CORRECT** :
```javascript
// Les num√©ros de semaine sont d√©j√† dans calendrier[date].numeroSemaine
```

### 3. Conflit de noms de fonctions
Si tu rencontres des erreurs "Invalid Date", v√©rifie qu'il n'y a pas de **conflit de noms** entre :
- Les fonctions de `calendrier-vue.js`
- Les fonctions globales d'autres modules

**Solution** : Pr√©fixer les fonctions du module (ex: `calendrierVue_genererHtml()`)

---

## üß™ Tests √† faire apr√®s refonte

### Test 1 : V√©rifier la lecture
```javascript
// Dans la console
const cal = obtenirCalendrierComplet();
console.log('Nombre de jours:', Object.keys(cal).length); // Doit √™tre 124
console.log('Premier jour:', cal['2025-08-21']); // Doit avoir statut "cours"
console.log('Weekend:', cal['2025-08-23']); // Doit avoir statut "weekend"
```

### Test 2 : Affichage visuel
- Le calendrier s'affiche-t-il correctement ?
- Les couleurs correspondent-elles aux statuts ?
- Les weekends sont-ils gris√©s ?
- Les cong√©s sont-ils visibles ?
- Les reprises ont-elles leur couleur sp√©cifique ?

### Test 3 : Statistiques
Les cartes de statistiques doivent afficher :
- 16 semaines scolaires
- 75 jours de cours
- 2 cong√©s avec reprises

---

## üìÅ Fichiers concern√©s

### √Ä modifier
- `js/calendrier-vue.js` (refonte compl√®te)

### √Ä NE PAS toucher
- `js/trimestre.js` (d√©j√† refait, fonctionne parfaitement)
- `localStorage.calendrierComplet` (source unique de v√©rit√©)

### D√©pendances
Le module `calendrier-vue.js` d√©pend de :
- `trimestre.js` (pour `obtenirCalendrierComplet()`)
- `config.js` (variables CSS)
- `styles.css` (classes de couleurs)

---

## üéØ Crit√®res de r√©ussite

Le module `calendrier-vue.js` sera consid√©r√© comme r√©ussi quand :

1. ‚úÖ Il lit `calendrierComplet` sans recalculer
2. ‚úÖ Il affiche le calendrier visuel avec les bonnes couleurs
3. ‚úÖ Il n'y a aucune incoh√©rence de donn√©es
4. ‚úÖ Les logs montrent qu'il ne fait que de la lecture
5. ‚úÖ Aucune erreur dans la console
6. ‚úÖ Le code est plus court et plus simple que l'original

---

## üöÄ Ordre des op√©rations

1. **Analyser** `calendrier-vue.js` actuel (identifier la logique √† supprimer)
2. **Cr√©er** la nouvelle version simplifi√©e
3. **Tester** √©tape par √©tape
4. **Valider** avec les tests ci-dessus
5. **Commit 2** : "Refonte calendrier-vue.js - Lecture seule du calendrier complet"

---

## üí° Principes √† retenir

### Architecture globale
```
R√âGLAGES (modules "sources")
‚îú‚îÄ trimestre.js ‚Üí g√©n√®re calendrierComplet
‚îú‚îÄ horaire.js ‚Üí g√©n√©rera seancesCompletes (√† venir)
‚îî‚îÄ groupe.js ‚Üí g√®re les √©l√®ves

PR√âSENCES (modules "lecteurs")
‚îú‚îÄ calendrier-vue.js ‚Üí lit calendrierComplet
‚îú‚îÄ calendrier-saisie.js ‚Üí lit seancesCompletes
‚îî‚îÄ assiduite (dans tableau-bord) ‚Üí lit tout

TABLEAU DE BORD (module "synth√®se")
‚îî‚îÄ Calcule les indices en lisant toutes les sources
```

### R√®gle d'or
**Les modules ne se parlent JAMAIS directement.**
Ils communiquent via **localStorage** uniquement.

---

## üìû Si tu rencontres un probl√®me

### Sympt√¥mes courants

**"Invalid Date" dans le calendrier**
‚Üí Conflit de noms de fonctions (v√©rifier `formaterDate`)

**Calendrier vide**
‚Üí V√©rifier que `calendrierComplet` existe dans localStorage

**Mauvaises couleurs**
‚Üí V√©rifier le mapping statut ‚Üí classe CSS

**Erreur "function not defined"**
‚Üí V√©rifier l'ordre de chargement des scripts dans index 70

### Debug g√©n√©ral
```javascript
// Console du navigateur
console.log('calendrierComplet existe?', !!localStorage.getItem('calendrierComplet'));
console.log('Nombre de jours:', Object.keys(JSON.parse(localStorage.getItem('calendrierComplet'))).length);
console.log('API disponible?', typeof obtenirCalendrierComplet);
```

---

## üéì Contexte du projet

**Syst√®me** : Application web de suivi des apprentissages (monitorage p√©dagogique)

**Origine** : Tableur Numbers fonctionnel mais maintenance laborieuse

**Objectif** : Application web avec interface efficace, logique de tableur sous-jacente

**Probl√®me r√©solu** : Modularisation anarchique cr√©ait incoh√©rences de donn√©es

**Solution** : Architecture "Single Source of Truth" - chaque donn√©e a UNE source

**Guide de collaboration** : Voir "Guide Claude - Instructions de collaboration.md" dans la base de connaissances

---

## ‚úÖ Checklist avant de commencer

- [ ] Lire ce document en entier
- [ ] V√©rifier que le commit 1 est fait
- [ ] V√©rifier que `calendrierComplet` existe dans localStorage
- [ ] Tester `obtenirCalendrierComplet()` dans la console
- [ ] Ouvrir `calendrier-vue.js` dans l'√©diteur
- [ ] Commencer l'analyse du code actuel

**Bon courage pour la suite ! üöÄ**